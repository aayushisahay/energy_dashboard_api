//energychart.js
import React, { useEffect, useState } from 'react';
import Highcharts from 'highcharts';
import HighchartsReact from 'highcharts-react-official';
import { getEnergySummary } from '../services/api';

const EnergyChart = () => {
  const [chartOptions, setChartOptions] = useState(null);

  useEffect(() => {
    const fetchData = async () => {
      try {
        const data = await getEnergySummary([1], '2024-01-01T00:00:00', '2024-04-30T23:00:00');
        console.log("Fetched data:", data)

        const categories = data.hourlyAggregated.map(item => item.timestamp);
        const values = data.hourlyAggregated.map(item => item.energyConsumed);

        setChartOptions({
          title: { text: 'Energy Consumption Over Time' },
          xAxis: { categories },
          yAxis: { title: { text: 'Energy Consumed (kWh)' } },
          series: [{ name: 'Energy', data: values }],
        });
      } catch (error) {
        console.error("Error loading chart:", error);
      }
    };

    fetchData();
  }, []);

  return (
    <div>
      {chartOptions ? (
        <HighchartsReact highcharts={Highcharts} options={chartOptions} />
      ) : (
        <p>Loading chart...</p>
      )}
    </div>
  );
};

export default EnergyChart;



//ap.js
import React from 'react';
import './App.css';
import EnergyChart from './components/EnergyChart'; 
function App() {
  return (
    <div className="App">
      <h1>Energy Consumption Dashboard</h1>
      <EnergyChart /> 
    </div>
  );
}

export default App;



//api.js
import axios from 'axios';

const BASE_URL = 'http://localhost:5076/api'; 
export const getEnergySummary = async (spaceIds, startTime, endTime) => {
  try {
    const response = await axios.get(`${BASE_URL}/MeterReadings/energy-summary`, {
      params: {
        spaceIds,
        startTime,
        endTime,

      },
    });

    console.log(" API Response from getEnergySummary:", response.data); 
    return response.data;
  } catch (error) {
    console.error(" API Error:", error);
    throw error;
  }
};
